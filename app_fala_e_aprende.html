<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fala e Aprende - Alfabetiza√ß√£o Divertida</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0f9ff; /* Azul bem suave */
            touch-action: manipulation;
        }

        /* Anima√ß√£o de sucesso */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .card-pop {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Anima√ß√£o de erro (tremor) */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .card-shake {
            animation: shake 0.3s ease-in-out;
        }

        /* Confetti simples CSS */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: fall linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); }
        }

        /* Anima√ß√£o do Trof√©u */
        @keyframes trophy-pop {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            80% { transform: scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .trophy-anim {
            animation: trophy-pop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-between overflow-hidden select-none relative">

    <!-- Overlay de Recompensa (Escondido por padr√£o) -->
    <div id="reward-overlay" class="fixed inset-0 bg-black/50 z-50 hidden flex flex-col items-center justify-center backdrop-blur-sm transition-opacity">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center transform scale-0 trophy-anim">
            <div class="text-8xl mb-4">üèÜ</div>
            <h2 class="text-3xl font-bold text-yellow-500 mb-2">Parab√©ns!</h2>
            <p class="text-gray-600 text-xl font-semibold">Voc√™ completou mais 5!</p>
            <button onclick="closeReward()" class="mt-6 px-6 py-3 bg-blue-500 text-white rounded-full font-bold text-lg hover:bg-blue-600 transition shadow-lg">Continuar</button>
        </div>
    </div>

    <!-- Header / Menu -->
    <header class="w-full p-4 flex flex-col gap-3 bg-white shadow-sm z-10">
        <div class="flex justify-between items-center w-full">
            <h1 class="text-xl sm:text-2xl font-bold text-blue-500 flex items-center gap-2">
                ü¶ú Fala e Aprende
            </h1>
            
            <!-- Recorde Display -->
            <div class="bg-yellow-100 px-3 py-1 rounded-full border border-yellow-300 flex items-center gap-1 shadow-sm">
                <span class="text-yellow-600 text-sm font-bold">üèÜ Recorde:</span>
                <span id="record-display" class="text-yellow-700 font-bold text-lg">0</span>
            </div>

            <!-- Bot√µes de Configura√ß√£o -->
            <div class="flex gap-2">
                 <!-- Bot√£o Carregar JSON -->
                 <button onclick="document.getElementById('file-input').click()" class="px-3 py-2 rounded-full font-bold bg-green-100 text-green-700 transition transform hover:scale-105 border-2 border-green-200 text-sm flex items-center gap-1" title="Carregar arquivo JSON de palavras">
                    üìÅ <span class="hidden sm:inline">Carregar</span>
                </button>
                <input type="file" id="file-input" accept=".json" class="hidden" onchange="loadUserJson(this)">

                 <!-- Bot√£o Aleat√≥rio -->
                <button onclick="toggleRandom()" id="btn-random" class="px-3 py-2 rounded-full font-bold bg-gray-200 text-gray-600 transition transform hover:scale-105 border-2 border-transparent text-sm" title="Modo Aleat√≥rio">
                    üîÄ <span class="hidden sm:inline">Aleat√≥rio</span>
                </button>
                <!-- Bot√£o Acentos -->
                <button onclick="toggleAccents()" id="btn-accents" class="px-3 py-2 rounded-full font-bold bg-gray-200 text-gray-600 transition transform hover:scale-105 border-2 border-transparent text-sm" title="Ativar Acentos (√ÉO, √ä, √ì...)">
                    ^~ <span class="hidden sm:inline">Acentos</span>
                </button>
            </div>
        </div>

        <div class="flex gap-2 flex-wrap justify-center w-full">
            <button onclick="setMode('letras')" id="btn-letras" class="mode-btn px-4 py-2 rounded-full font-bold bg-blue-500 text-white transition transform hover:scale-105 text-sm flex-grow sm:flex-grow-0">Letras</button>
            <button onclick="setMode('silabas')" id="btn-silabas" class="mode-btn px-4 py-2 rounded-full font-bold bg-gray-200 text-gray-600 transition transform hover:scale-105 text-sm flex-grow sm:flex-grow-0">S√≠labas</button>
            <button onclick="setMode('palavras')" id="btn-palavras" class="mode-btn px-4 py-2 rounded-full font-bold bg-gray-200 text-gray-600 transition transform hover:scale-105 text-sm flex-grow sm:flex-grow-0">Palavras</button>
        </div>
    </header>

    <!-- √Årea Principal de Conte√∫do -->
    <main class="flex-grow flex flex-col items-center justify-center w-full max-w-4xl relative px-4">
        
        <!-- Pontua√ß√£o (Agora mostra n√∫mero tamb√©m) -->
        <div class="absolute top-0 right-4 flex flex-col items-end pointer-events-none">
            <div class="flex gap-1 mb-1" id="stars-container">
                <!-- Estrelas inseridas via JS -->
            </div>
            <div class="text-blue-400 font-bold text-sm bg-white/80 px-2 rounded-full backdrop-blur-sm shadow-sm border border-blue-100">
                <span id="score-number">0</span> Estrelas
            </div>
        </div>

        <!-- Cart√£o de Pergunta (Adapt√°vel) -->
        <div id="game-card" class="bg-white rounded-3xl shadow-lg p-8 w-auto min-w-[300px] min-h-[300px] sm:min-w-[400px] sm:min-h-[400px] max-w-full flex flex-col items-center justify-center text-center border-4 border-blue-200 relative card-pop transition-all duration-200">
            
            <!-- √Årea do Emoji / Dica -->
            <div class="h-24 flex items-center justify-center mb-2 w-full relative">
                <!-- Emoji (Absolute para n√£o pular layout) -->
                <div id="display-emoji" class="text-6xl hidden transition-all duration-500 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">üçé</div>
                
                <!-- Bot√£o Dica -->
                <button id="btn-reveal-emoji" onclick="showEmoji()" class="hidden px-5 py-3 bg-yellow-100 text-yellow-700 rounded-full text-lg font-bold hover:bg-yellow-200 transition border-2 border-yellow-300 shadow-md z-10 active:scale-95 flex items-center gap-2">
                    <span>üôà</span> Ver Dica
                </button>
            </div>
            
            <!-- Texto Principal -->
            <div id="display-text" class="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-bold text-slate-700 tracking-wider mt-4 break-words">A</div>
            
        </div>

        <!-- Feedback Visual -->
        <div id="feedback-msg" class="h-10 mt-4 text-xl font-bold text-center text-blue-500 transition-all opacity-0 transform translate-y-4">
            Muito bem!
        </div>

    </main>

    <!-- Controles -->
    <footer class="w-full bg-white p-4 sm:p-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] rounded-t-3xl z-20">
        <div class="flex flex-col items-center gap-2">
            
            <div class="flex w-full justify-center gap-4 sm:gap-8 items-center max-w-lg px-4">
                
                <!-- Bot√£o Ouvir -->
                <button onclick="speakCurrentItem()" class="flex flex-col items-center justify-center w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-yellow-100 text-yellow-600 hover:bg-yellow-200 shadow-md transition transform active:scale-95" title="Ouvir pron√∫ncia">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 sm:h-10 sm:w-10 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                    </svg>
                    <span class="text-[10px] sm:text-xs font-bold">Ouvir</span>
                </button>

                 <!-- Bot√£o Errou (Novo) -->
                 <button onclick="handleManualError()" class="flex flex-col items-center justify-center w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-red-100 text-red-500 hover:bg-red-200 shadow-lg transition transform active:scale-95 border-2 border-red-200" title="Errou (Perde estrelas)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 sm:h-12 sm:w-12 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                    <span class="text-xs sm:text-sm font-bold">Tentar</span>
                </button>

                <!-- Bot√£o Acertou -->
                <button onclick="handleSuccess()" class="flex flex-col items-center justify-center w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-green-500 text-white hover:bg-green-600 shadow-lg transition transform active:scale-95 ring-4 ring-green-100" title="Acertou! (Pr√≥ximo)">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 sm:h-12 sm:w-12 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                    </svg>
                    <span class="text-xs sm:text-sm font-bold">Acertou!</span>
                </button>

            </div>
        </div>
    </footer>

    <!-- Scripts de L√≥gica -->
    <script>
        // --- Dados do App ---
        const data = {
            letras: [
                { text: "A", display: "A", emoji: "‚úàÔ∏è" }, { text: "B", display: "B", emoji: "‚öΩ" }, 
                { text: "C", display: "C", emoji: "üè†" }, { text: "D", display: "D", emoji: "üé≤" }, 
                { text: "E", display: "E", emoji: "üêò" }, { text: "F", display: "F", emoji: "ü¶≠" },
                { text: "G", display: "G", emoji: "üê±" }, { text: "H", display: "H", emoji: "üöÅ" }, 
                { text: "I", display: "I", emoji: "üèùÔ∏è" }, { text: "J", display: "J", emoji: "üêä" }, 
                { text: "K", display: "K", emoji: "ü•ù" }, { text: "L", display: "L", emoji: "ü¶Å" },
                { text: "M", display: "M", emoji: "üçé" }, { text: "N", display: "N", emoji: "üö¢" }, 
                { text: "O", display: "O", emoji: "ü•ö" }, { text: "P", display: "P", emoji: "ü¶Ü" }, 
                { text: "Q", display: "Q", emoji: "üßÄ" }, { text: "R", display: "R", emoji: "üê≠" },
                { text: "S", display: "S", emoji: "‚òÄÔ∏è" }, { text: "T", display: "T", emoji: "üê¢" }, 
                { text: "U", display: "U", emoji: "üçá" }, { text: "V", display: "V", emoji: "üêÑ" }, 
                { text: "W", display: "W", emoji: "üßá" }, { text: "X", display: "X", emoji: "‚òï" },
                { text: "Y", display: "Y", emoji: "üçú" }, { text: "Z", display: "Z", emoji: "ü¶ì" }
            ],
            silabas: [
                // Simples
                { text: "BA", display: "BA" }, { text: "BE", display: "BE" }, { text: "BI", display: "BI" }, { text: "BO", display: "BO" }, { text: "BU", display: "BU" },
                { text: "CA", display: "CA" }, { text: "CE", display: "CE" }, { text: "CI", display: "CI" }, { text: "CO", display: "CO" }, { text: "CU", display: "CU" },
                { text: "DA", display: "DA" }, { text: "DE", display: "DE" }, { text: "DI", display: "DI" }, { text: "DO", display: "DO" }, { text: "DU", display: "DU" },
                { text: "FA", display: "FA" }, { text: "FE", display: "FE" }, { text: "FI", display: "FI" }, { text: "FO", display: "FO" }, { text: "FU", display: "FU" },
                { text: "GA", display: "GA" }, { text: "GE", display: "GE" }, { text: "GI", display: "GI" }, { text: "GO", display: "GO" }, { text: "GU", display: "GU" },
                { text: "JA", display: "JA" }, { text: "JE", display: "JE" }, { text: "JI", display: "JI" }, { text: "JO", display: "JO" }, { text: "JU", display: "JU" },
                { text: "LA", display: "LA" }, { text: "LE", display: "LE" }, { text: "LI", display: "LI" }, { text: "LO", display: "LO" }, { text: "LU", display: "LU" },
                { text: "MA", display: "MA" }, { text: "ME", display: "ME" }, { text: "MI", display: "MI" }, { text: "MO", display: "MO" }, { text: "MU", display: "MU" },
                { text: "NA", display: "NA" }, { text: "NE", display: "NE" }, { text: "NI", display: "NI" }, { text: "NO", display: "NO" }, { text: "NU", display: "NU" },
                { text: "PA", display: "PA" }, { text: "PE", display: "PE" }, { text: "PI", display: "PI" }, { text: "PO", display: "PO" }, { text: "PU", display: "PU" },
                { text: "QUA", display: "QUA" }, { text: "QUE", display: "QUE" }, { text: "QUI", display: "QUI" }, { text: "QUO", display: "QUO" },
                { text: "RA", display: "RA" }, { text: "RE", display: "RE" }, { text: "RI", display: "RI" }, { text: "RO", display: "RO" }, { text: "RU", display: "RU" },
                { text: "SA", display: "SA" }, { text: "SE", display: "SE" }, { text: "SI", display: "SI" }, { text: "SO", display: "SO" }, { text: "SU", display: "SU" },
                { text: "TA", display: "TA" }, { text: "TE", display: "TE" }, { text: "TI", display: "TI" }, { text: "TO", display: "TO" }, { text: "TU", display: "TU" },
                { text: "VA", display: "VA" }, { text: "VE", display: "VE" }, { text: "VI", display: "VI" }, { text: "VO", display: "VO" }, { text: "VU", display: "VU" },
                { text: "XA", display: "XA" }, { text: "XE", display: "XE" }, { text: "XI", display: "XI" }, { text: "XO", display: "XO" }, { text: "XU", display: "XU" },
                { text: "ZA", display: "ZA" }, { text: "ZE", display: "ZE" }, { text: "ZI", display: "ZI" }, { text: "ZO", display: "ZO" }, { text: "ZU", display: "ZU" },
                
                // Com Acentos (Opcionais)
                { text: "B√ÉO", display: "B√ÉO", isAccent: true }, { text: "C√ÉO", display: "C√ÉO", isAccent: true }, 
                { text: "D√ÉO", display: "D√ÉO", isAccent: true }, { text: "F√ÉO", display: "F√ÉO", isAccent: true },
                { text: "G√ÉO", display: "G√ÉO", isAccent: true }, { text: "L√ÉO", display: "L√ÉO", isAccent: true }, { text: "L√É", display: "L√É", isAccent: true },
                { text: "M√ÉO", display: "M√ÉO", isAccent: true }, { text: "M√ÉE", display: "M√ÉE", isAccent: true },
                { text: "N√ÉO", display: "N√ÉO", isAccent: true }, 
                { text: "P√ÉO", display: "P√ÉO", isAccent: true }, { text: "P√ïE", display: "P√ïE", isAccent: true },
                { text: "R√ÉO", display: "R√ÉO", isAccent: true },
                { text: "S√ÉO", display: "S√ÉO", isAccent: true }, 
                { text: "T√ÉO", display: "T√ÉO", isAccent: true },
                { text: "V√ÉO", display: "V√ÉO", isAccent: true }, { text: "V√ì", display: "V√ì", isAccent: true }, { text: "V√î", display: "V√î", isAccent: true },
                { text: "Z√ÉO", display: "Z√ÉO", isAccent: true },
                { text: "CH√ÉO", display: "CH√ÉO", isAccent: true }, { text: "NH√ÉO", display: "NH√ÉO", isAccent: true }, { text: "LH√ÉO", display: "LH√ÉO", isAccent: true }
            ],
            palavras: [
                // --- ANIMAIS ---
                { text: "GATO", emoji: "üê±" }, { text: "CACHORRO", emoji: "üê∂" }, { text: "P√ÅSSARO", emoji: "üê¶" }, { text: "PEIXE", emoji: "üê†" },
                { text: "ELEFANTE", emoji: "üêò" }, { text: "LE√ÉO", emoji: "ü¶Å" }, { text: "TIGRE", emoji: "üêØ" }, { text: "URSO", emoji: "üêª" },
                { text: "COELHO", emoji: "üê∞" }, { text: "RATO", emoji: "üê≠" }, { text: "COBRA", emoji: "üêç" }, { text: "TARTARUGA", emoji: "üê¢" },
                { text: "SAPO", emoji: "üê∏" }, { text: "MACACO", emoji: "üêµ" }, { text: "GIRAFA", emoji: "ü¶í" }, { text: "ZEBRA", emoji: "ü¶ì" },
                { text: "RINOCERONTE", emoji: "ü¶è" }, { text: "HIPOP√ìTAMO", emoji: "ü¶õ" }, { text: "CROCODILO", emoji: "üêä" }, { text: "VACA", emoji: "üêÑ" },
                { text: "PORCO", emoji: "üê∑" }, { text: "OVELHA", emoji: "üêë" }, { text: "CAVALO", emoji: "üêé" }, { text: "GALINHA", emoji: "üêî" },
                { text: "PATO", emoji: "ü¶Ü" }, { text: "ABELHA", emoji: "üêù" }, { text: "BORBOLETA", emoji: "ü¶ã" }, { text: "ARANHA", emoji: "üï∑Ô∏è" },
                { text: "FORMIGA", emoji: "üêú" }, { text: "BALEIA", emoji: "üêã" }, { text: "GOLFINHO", emoji: "üê¨" }, { text: "TUBAR√ÉO", emoji: "ü¶à" },
                { text: "POLVO", emoji: "üêô" }, { text: "CARANGUEJO", emoji: "ü¶Ä" }, { text: "PINGUIM", emoji: "üêß" }, { text: "FOCA", emoji: "ü¶≠" },
                { text: "PANDA", emoji: "üêº" }, { text: "CANGURU", emoji: "ü¶ò" }, { text: "CAMELO", emoji: "üê™" }, { text: "RAPOSA", emoji: "ü¶ä" },
                { text: "LOBO", emoji: "üê∫" }, { text: "ESQUILO", emoji: "üêøÔ∏è" }, { text: "ON√áA", emoji: "üêÜ" }, { text: "GORILA", emoji: "ü¶ç" },
                { text: "PAV√ÉO", emoji: "ü¶ö" }, { text: "PAPAGAIO", emoji: "ü¶ú" }, { text: "CORUJA", emoji: "ü¶â" }, { text: "√ÅGUIA", emoji: "ü¶Ö" },
                { text: "JOANINHA", emoji: "üêû" }, { text: "CARACOL", emoji: "üêå" }, { text: "LULA", emoji: "ü¶ë" }, { text: "CAMAR√ÉO", emoji: "ü¶ê" },
                
                // --- NATUREZA ---
                { text: "√ÅRVORE", emoji: "üå≥" }, { text: "FLOR", emoji: "üå∏" }, { text: "ROSA", emoji: "üåπ" }, { text: "GIRASSOL", emoji: "üåª" },
                { text: "CACTO", emoji: "üåµ" }, { text: "PALMEIRA", emoji: "üå¥" }, { text: "FOLHA", emoji: "üçÉ" }, { text: "SOL", emoji: "‚òÄÔ∏è" },
                { text: "LUA", emoji: "üåô" }, { text: "ESTRELA", emoji: "‚≠ê" }, { text: "NUVEM", emoji: "‚òÅÔ∏è" }, { text: "CHUVA", emoji: "üåßÔ∏è" },
                { text: "NEVE", emoji: "‚ùÑÔ∏è" }, { text: "VENTO", emoji: "üí®" }, { text: "RAIO", emoji: "‚ö°" }, { text: "ARCO-√çRIS", emoji: "üåà" },
                { text: "MAR", emoji: "üåä" }, { text: "MONTANHA", emoji: "‚õ∞Ô∏è" }, { text: "VULC√ÉO", emoji: "üåã" }, { text: "ILHA", emoji: "üèùÔ∏è" },
                { text: "DESERTO", emoji: "üèúÔ∏è" }, { text: "RIO", emoji: "üèûÔ∏è" }, { text: "FOGO", emoji: "üî•" }, { text: "√ÅGUA", emoji: "üíß" },
                { text: "PEDRA", emoji: "ü™®" }, { text: "PLANETA", emoji: "ü™ê" }, { text: "COMETA", emoji: "‚òÑÔ∏è" }, { text: "MUNDO", emoji: "üåç" },

                // --- ALIMENTOS ---
                { text: "MA√á√É", emoji: "üçé" }, { text: "BANANA", emoji: "üçå" }, { text: "LARANJA", emoji: "üçä" }, { text: "UVA", emoji: "üçá" },
                { text: "MORANGO", emoji: "üçì" }, { text: "MELANCIA", emoji: "üçâ" }, { text: "MEL√ÉO", emoji: "üçà" }, { text: "ABACAXI", emoji: "üçç" },
                { text: "PERA", emoji: "üçê" }, { text: "P√äSSEGO", emoji: "üçë" }, { text: "CEREJA", emoji: "üçí" }, { text: "LIM√ÉO", emoji: "üçã" },
                { text: "COCO", emoji: "ü••" }, { text: "KIWI", emoji: "ü•ù" }, { text: "TOMATE", emoji: "üçÖ" }, { text: "ABACATE", emoji: "ü•ë" },
                { text: "BATATA", emoji: "ü•î" }, { text: "CENOURA", emoji: "ü•ï" }, { text: "MILHO", emoji: "üåΩ" }, { text: "PIMENTA", emoji: "üå∂Ô∏è" },
                { text: "BR√ìCOLIS", emoji: "ü•¶" }, { text: "COGUMELO", emoji: "üçÑ" }, { text: "P√ÉO", emoji: "üçû" }, { text: "QUEIJO", emoji: "üßÄ" },
                { text: "OVO", emoji: "ü•ö" }, { text: "CARNE", emoji: "ü•©" }, { text: "FRANGO", emoji: "üçó" }, { text: "HAMB√öRGUER", emoji: "üçî" },
                { text: "BATATA-FRITA", emoji: "üçü" }, { text: "PIZZA", emoji: "üçï" }, { text: "CACHORRO-QUENTE", emoji: "üå≠" }, { text: "SANDU√çCHE", emoji: "ü•™" },
                { text: "TACO", emoji: "üåÆ" }, { text: "BURRITO", emoji: "üåØ" }, { text: "OVO-FRITO", emoji: "üç≥" }, { text: "PIPOCA", emoji: "üçø" },
                { text: "ARROZ", emoji: "üçö" }, { text: "MACARR√ÉO", emoji: "üçù" }, { text: "SUSHI", emoji: "üç£" }, { text: "SORVETE", emoji: "üç¶" },
                { text: "BOLO", emoji: "üç∞" }, { text: "CHOCOLATE", emoji: "üç´" }, { text: "BALA", emoji: "üç¨" }, { text: "PIRULITO", emoji: "üç≠" },
                { text: "BISCOITO", emoji: "üç™" }, { text: "ROSQUINHA", emoji: "üç©" }, { text: "PUDIM", emoji: "üçÆ" }, { text: "MEL", emoji: "üçØ" },
                { text: "LEITE", emoji: "ü•õ" }, { text: "CAF√â", emoji: "‚òï" }, { text: "CH√Å", emoji: "üçµ" }, { text: "SUCO", emoji: "üßÉ" },

                // --- LUGARES E CONSTRU√á√ïES ---
                { text: "CASA", emoji: "üè†" }, { text: "ESCOLA", emoji: "üè´" }, { text: "HOSPITAL", emoji: "üè•" }, { text: "BANCO", emoji: "üè¶" },
                { text: "HOTEL", emoji: "üè®" }, { text: "IGREJA", emoji: "‚õ™" }, { text: "CASTELO", emoji: "üè∞" }, { text: "PR√âDIO", emoji: "üè¢" },
                { text: "F√ÅBRICA", emoji: "üè≠" }, { text: "EST√ÅDIO", emoji: "üèüÔ∏è" }, { text: "PARQUE", emoji: "‚õ≤" }, { text: "PRAIA", emoji: "üèñÔ∏è" },
                { text: "ZOOL√ìGICO", emoji: "ü¶Å" }, { text: "CIRCO", emoji: "üé™" }, { text: "LOJA", emoji: "üè™" }, { text: "MERCADO", emoji: "üõí" },
                { text: "PONTE", emoji: "üåâ" }, { text: "RUA", emoji: "üõ£Ô∏è" }, { text: "ESTRADA", emoji: "üõ§Ô∏è" }, { text: "AEROPORTO", emoji: "üõ´" },

                // --- OBJETOS E BRINQUEDOS ---
                { text: "BOLA", emoji: "‚öΩ" }, { text: "BONECA", emoji: "üéé" }, { text: "PIPA", emoji: "ü™Å" }, { text: "I√î-I√î", emoji: "ü™Ä" },
                { text: "ROB√î", emoji: "ü§ñ" }, { text: "URSO DE PEL√öCIA", emoji: "üß∏" }, { text: "DADO", emoji: "üé≤" }, { text: "VIDEOGAME", emoji: "üéÆ" },
                { text: "LIVRO", emoji: "üìñ" }, { text: "L√ÅPIS", emoji: "‚úèÔ∏è" }, { text: "CANETA", emoji: "üñäÔ∏è" }, { text: "TESOURA", emoji: "‚úÇÔ∏è" },
                { text: "MOCHILA", emoji: "üéí" }, { text: "COMPUTADOR", emoji: "üíª" }, { text: "TELEFONE", emoji: "üì±" }, { text: "C√ÇMERA", emoji: "üì∑" },
                { text: "REL√ìGIO", emoji: "‚è∞" }, { text: "L√ÇMPADA", emoji: "üí°" }, { text: "VELA", emoji: "üïØÔ∏è" }, { text: "CHAVE", emoji: "üîë" },
                { text: "CADEADO", emoji: "üîí" }, { text: "MARTELO", emoji: "üî®" }, { text: "SERROTE", emoji: "ü™ö" }, { text: "PARA-FUSO", emoji: "üî©" },
                { text: "ESCADA", emoji: "ü™ú" }, { text: "ESPELHO", emoji: "ü™û" }, { text: "CAMA", emoji: "üõèÔ∏è" }, { text: "SOF√Å", emoji: "üõãÔ∏è" },
                { text: "CADEIRA", emoji: "ü™ë" }, { text: "BANHEIRA", emoji: "üõÅ" }, { text: "SABONETE", emoji: "üßº" }, { text: "ESCOVA", emoji: "ü™•" },
                { text: "VASSOURA", emoji: "üßπ" }, { text: "BALDE", emoji: "ü™£" }, { text: "ESPONJA", emoji: "üßΩ" }, { text: "DINHEIRO", emoji: "üíµ" },
                { text: "PRESENTE", emoji: "üéÅ" }, { text: "BAL√ÉO", emoji: "üéà" }, { text: "CARTA", emoji: "‚úâÔ∏è" }, { text: "JORNAL", emoji: "üì∞" },
                { text: "LIXO", emoji: "üóëÔ∏è" },

                // --- TRANSPORTE ---
                { text: "CARRO", emoji: "üöó" }, { text: "T√ÅXI", emoji: "üöï" }, { text: "√îNIBUS", emoji: "üöå" }, { text: "CAMINH√ÉO", emoji: "üöõ" },
                { text: "TRATOR", emoji: "üöú" }, { text: "BICICLETA", emoji: "üö≤" }, { text: "MOTO", emoji: "üèçÔ∏è" }, { text: "TREM", emoji: "üöÇ" },
                { text: "AVI√ÉO", emoji: "‚úàÔ∏è" }, { text: "HELIC√ìPTERO", emoji: "üöÅ" }, { text: "FOGUETE", emoji: "üöÄ" }, { text: "NAVIO", emoji: "üö¢" },
                { text: "BARCO", emoji: "‚õµ" }, { text: "CANOA", emoji: "üõ∂" }, { text: "SUBMARINO", emoji: "üõ≥Ô∏è" }, { text: "AMBUL√ÇNCIA", emoji: "üöë" },
                { text: "BOMBEIRO", emoji: "üöí" }, { text: "POL√çCIA", emoji: "üöì" },

                // --- ROUPAS E ACESS√ìRIOS ---
                { text: "CAMISA", emoji: "üëï" }, { text: "CAL√áA", emoji: "üëñ" }, { text: "VESTIDO", emoji: "üëó" }, { text: "SAIA", emoji: "üëô" },
                { text: "CASACO", emoji: "üß•" }, { text: "MEIA", emoji: "üß¶" }, { text: "SAPATO", emoji: "üëû" }, { text: "T√äNIS", emoji: "üëü" },
                { text: "BOTA", emoji: "üë¢" }, { text: "CHAP√âU", emoji: "üé©" }, { text: "BON√â", emoji: "üß¢" }, { text: "√ìCULOS", emoji: "üëì" },
                { text: "GRAVATA", emoji: "üëî" }, { text: "LUVA", emoji: "üß§" }, { text: "CACHECOL", emoji: "üß£" }, { text: "ANEL", emoji: "üíç" },
                { text: "COROA", emoji: "üëë" }, { text: "BOLSA", emoji: "üëú" }, { text: "GUARDA-CHUVA", emoji: "‚òÇÔ∏è" }, { text: "BATOM", emoji: "üíÑ" },

                // --- CORPO HUMANO ---
                { text: "OLHO", emoji: "üëÅÔ∏è" }, { text: "ORELHA", emoji: "üëÇ" }, { text: "NARIZ", emoji: "üëÉ" }, { text: "BOCA", emoji: "üëÑ" },
                { text: "DENTE", emoji: "ü¶∑" }, { text: "L√çNGUA", emoji: "üëÖ" }, { text: "M√ÉO", emoji: "‚úã" }, { text: "P√â", emoji: "ü¶∂" },
                { text: "PERNA", emoji: "ü¶µ" }, { text: "BRA√áO", emoji: "üí™" }, { text: "DEDO", emoji: "üëÜ" }, { text: "UNHA", emoji: "üíÖ" },
                { text: "CORA√á√ÉO", emoji: "‚ù§Ô∏è" }, { text: "C√âREBRO", emoji: "üß†" }, { text: "OSSO", emoji: "ü¶¥" }, { text: "SANGUE", emoji: "ü©∏" },

                // --- PESSOAS E PROFISS√ïES ---
                { text: "BEB√ä", emoji: "üë∂" }, { text: "MENINO", emoji: "üë¶" }, { text: "MENINA", emoji: "üëß" }, { text: "HOMEM", emoji: "üë®" },
                { text: "MULHER", emoji: "üë©" }, { text: "IDOSO", emoji: "üë¥" }, { text: "IDOSA", emoji: "üëµ" }, { text: "FAM√çLIA", emoji: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
                { text: "AMIGO", emoji: "üë´" }, { text: "NOIVA", emoji: "üë∞" }, { text: "NOIVO", emoji: "ü§µ" }, { text: "REI", emoji: "ü§¥" },
                { text: "PRINCESA", emoji: "üë∏" }, { text: "ANJO", emoji: "üëº" }, { text: "PAPAI NOEL", emoji: "üéÖ" }, { text: "FANTASMA", emoji: "üëª" },
                { text: "ET", emoji: "üëΩ" }, { text: "ROB√î", emoji: "ü§ñ" }, { text: "POLICIAL", emoji: "üëÆ" }, { text: "BOMBEIRO", emoji: "üë®‚Äçüöí" },
                { text: "M√âDICO", emoji: "üë®‚Äç‚öïÔ∏è" }, { text: "DENTISTA", emoji: "ü¶∑" }, { text: "VETERIN√ÅRIO", emoji: "üêæ" }, { text: "JUIZ", emoji: "üë®‚Äç‚öñÔ∏è" },
                { text: "COZINHEIRO", emoji: "üë®‚Äçüç≥" }, { text: "MEC√ÇNICO", emoji: "üë®‚Äçüîß" }, { text: "CIENTISTA", emoji: "üë®‚Äçüî¨" }, { text: "PINTOR", emoji: "üë®‚Äçüé®" },
                { text: "PILOTO", emoji: "üë®‚Äç‚úàÔ∏è" }, { text: "ASTRONAUTA", emoji: "üë®‚ÄçüöÄ" }, { text: "CANTOR", emoji: "üë®‚Äçüé§" }, { text: "ALUNO", emoji: "üéí" },
                { text: "PROFESSOR", emoji: "üè´" }, { text: "FAZENDEIRO", emoji: "üë®‚Äçüåæ" }, { text: "DETETIVE", emoji: "üïµÔ∏è" }, { text: "NINJA", emoji: "ü•∑" }
            ]
        };

        // --- Estado Global ---
        let currentMode = 'letras';
        let currentIndex = 0;
        let score = 0;
        let highScore = 0;
        let isProcessing = false;
        let isRandom = false; 
        let useAccents = false; // Novo: controle de acentos
        let activeList = []; // Nova lista din√¢mica
        // emojiTimeout removido pois n√£o √© mais necess√°rio

        // --- Inicializa√ß√£o de Voz ---
        const synth = window.speechSynthesis;

        // --- Fun√ß√µes Principais ---

        function init() {
            loadRecord();
            setMode('letras');
        }

        function loadRecord() {
            const savedRecord = localStorage.getItem('falaAprende_highScore');
            if (savedRecord) {
                highScore = parseInt(savedRecord, 10);
            }
            updateRecordDisplay();
        }

        function saveRecord() {
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('falaAprende_highScore', highScore.toString());
                updateRecordDisplay();
            }
        }

        function updateRecordDisplay() {
            document.getElementById('record-display').innerText = highScore;
        }

        function loadUserJson(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    
                    // Valida√ß√£o simples
                    if (Array.isArray(json) && json.length > 0 && json[0].text) {
                        // Substitui a lista de palavras
                        data.palavras = json;
                        
                        // Feedback visual
                        alert(`Sucesso! Carregadas ${json.length} novas palavras.`);
                        
                        // Se estiver no modo palavras, recarrega
                        if (currentMode === 'palavras') {
                            setMode('palavras');
                        }
                    } else {
                        alert("O formato do arquivo JSON parece incorreto. Certifique-se de usar: [{'text': 'A', 'emoji': 'üòÄ'}, ...]");
                    }
                } catch (error) {
                    alert("Erro ao ler o arquivo JSON. Verifique a sintaxe.");
                    console.error(error);
                }
            };
            reader.readAsText(file);
            // Limpa o input para permitir carregar o mesmo arquivo novamente se alterado
            input.value = '';
        }

        function toggleRandom() {
            isRandom = !isRandom;
            const btn = document.getElementById('btn-random');
            
            if (isRandom) {
                btn.classList.remove('bg-gray-200', 'text-gray-600');
                btn.classList.add('bg-orange-400', 'text-white', 'border-orange-500');
            } else {
                btn.classList.remove('bg-orange-400', 'text-white', 'border-orange-500');
                btn.classList.add('bg-gray-200', 'text-gray-600');
            }
            // Recalcula pr√≥ximo item
            nextLevel(true); 
        }

        function toggleAccents() {
            useAccents = !useAccents;
            const btn = document.getElementById('btn-accents');
            
            if (useAccents) {
                btn.classList.remove('bg-gray-200', 'text-gray-600');
                btn.classList.add('bg-purple-500', 'text-white', 'border-purple-600');
            } else {
                btn.classList.remove('bg-purple-500', 'text-white', 'border-purple-600');
                btn.classList.add('bg-gray-200', 'text-gray-600');
            }
            
            // Recarrega a lista baseada na nova configura√ß√£o
            updateActiveList();
            currentIndex = 0;
            loadCard();
        }

        function updateActiveList() {
            // Filtra a lista baseada no modo e na configura√ß√£o de acentos
            if (currentMode === 'silabas') {
                if (useAccents) {
                    activeList = data.silabas; // Todas
                } else {
                    activeList = data.silabas.filter(item => !item.isAccent); // Apenas sem flag de acento
                }
            } else {
                activeList = data[currentMode];
            }
        }

        function setMode(mode) {
            currentMode = mode;
            score = 0;
            renderStars();
            
            // Atualiza bot√µes de modo
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-600');
            });
            const activeBtn = document.getElementById(`btn-${mode}`);
            activeBtn.classList.remove('bg-gray-200', 'text-gray-600');
            activeBtn.classList.add('bg-blue-500', 'text-white');

            updateActiveList();

            if (isRandom) {
                currentIndex = Math.floor(Math.random() * activeList.length);
            } else {
                currentIndex = 0;
            }

            loadCard();
        }

        function loadCard() {
            if (activeList.length === 0) return;

            const item = activeList[currentIndex];
            const displayText = document.getElementById('display-text');
            const displayEmoji = document.getElementById('display-emoji');
            const revealBtn = document.getElementById('btn-reveal-emoji');
            const card = document.getElementById('game-card');

            // Anima√ß√£o de entrada
            card.classList.remove('card-pop');
            card.classList.remove('card-shake');
            void card.offsetWidth; 
            card.classList.add('card-pop');

            displayText.innerText = item.text;
            
            // Reset do estado do Emoji
            displayEmoji.classList.add('hidden');
            displayEmoji.classList.remove('animate-bounce');
            
            // Garante que o bot√£o comece escondido (reset)
            if (revealBtn) {
                revealBtn.classList.add('hidden'); 
            }

            if (item.emoji) {
                // Configura o emoji, mas mant√©m oculto
                displayEmoji.innerText = item.emoji;
                
                // Mostra o bot√£o "Ver Dica"
                if (revealBtn) {
                    revealBtn.classList.remove('hidden');
                    revealBtn.style.display = 'flex'; // Garante display flex para centralizar
                }
            }

            document.getElementById('feedback-msg').style.opacity = "0";
        }

        function showEmoji() {
            const displayEmoji = document.getElementById('display-emoji');
            const revealBtn = document.getElementById('btn-reveal-emoji');
            
            // Revela emoji e anima
            displayEmoji.classList.remove('hidden');
            displayEmoji.classList.add('animate-bounce');
            
            // Esconde o bot√£o
            if (revealBtn) {
                revealBtn.classList.add('hidden');
                revealBtn.style.display = 'none';
            }
        }

        function speakCurrentItem() {
            if (synth.speaking) synth.cancel();
            
            const item = activeList[currentIndex];
            let textToSpeak = item.text.toLowerCase();

            // Ajustes de pron√∫ncia
            if (currentMode === 'letras') {
                const map = {'m':'√™-me', 'l':'√©-le', 's':'√©s-se', 'r':'√©r-re', 'h':'ag√°', 'w':'d√°blio', 'y':'√≠psilon', 'k':'c√°', 'x':'xis'};
                if(map[textToSpeak]) textToSpeak = map[textToSpeak];
            }
            
            // Ajustes para s√≠labas espec√≠ficas que o sintetizador pode errar isoladamente
            if (textToSpeak === 'que') textToSpeak = 'qu√™';
            if (textToSpeak === 'se') textToSpeak = 's√™';

            const utterThis = new SpeechSynthesisUtterance(textToSpeak);
            utterThis.lang = 'pt-BR';
            utterThis.rate = 0.9; 
            synth.speak(utterThis);
        }

        function handleSuccess() {
            if (isProcessing) return;
            isProcessing = true;

            const feedback = document.getElementById('feedback-msg');
            
            feedback.innerText = "Muito bem! üéâ";
            feedback.classList.remove('text-red-500');
            feedback.classList.add('text-blue-500');
            feedback.style.opacity = "1";
            feedback.style.transform = "translateY(0)";
            
            createConfetti();
            playSound('success');

            score++;
            saveRecord(); // Checa se bateu recorde
            renderStars();

            // Verifica recompensa de 5 em 5
            if (score > 0 && score % 5 === 0) {
                 showReward();
                 // Delay maior se tiver recompensa
                 setTimeout(() => {
                    nextLevel();
                    isProcessing = false; 
                }, 3000); // 3 segundos para curtir a recompensa
            } else {
                setTimeout(() => {
                    nextLevel();
                    isProcessing = false; 
                }, 1500);
            }
        }

        function handleManualError() {
            if (isProcessing) return;
            // Se j√° for zero, n√£o faz nada visualmente diferente al√©m de tremer
            if (score > 0) {
                score = Math.max(0, score - 2);
                renderStars();
            }

            const feedback = document.getElementById('feedback-msg');
            feedback.innerText = "Ops! Tente de novo.";
            feedback.classList.remove('text-blue-500');
            feedback.classList.add('text-red-500');
            feedback.style.opacity = "1";
            feedback.style.transform = "translateY(0)";

            const card = document.getElementById('game-card');
            card.classList.remove('card-pop');
            card.classList.remove('card-shake');
            void card.offsetWidth; 
            card.classList.add('card-shake');

            playSound('error');
        }

        function showReward() {
            const overlay = document.getElementById('reward-overlay');
            overlay.classList.remove('hidden');
            // Confete extra
            createConfetti();
            createConfetti();
        }

        function closeReward() {
            document.getElementById('reward-overlay').classList.add('hidden');
        }

        function nextLevel(forceRandom = false) {
            // Se a lista estiver vazia ou com 1 item, n√£o faz nada
            if (activeList.length <= 1) return;

            if (isRandom || forceRandom) {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * activeList.length);
                } while (newIndex === currentIndex);
                currentIndex = newIndex;
            } else {
                if (currentIndex < activeList.length - 1) {
                    currentIndex++;
                } else {
                    currentIndex = 0; 
                    // Nota: N√£o zeramos o score no loop sequencial para permitir acumular recordes
                }
            }
            loadCard();
        }

        function renderStars() {
            const container = document.getElementById('stars-container');
            const numberDisplay = document.getElementById('score-number');
            
            numberDisplay.innerText = score;
            container.innerHTML = '';
            
            // Mostra at√© 5 estrelas visuais para n√£o poluir, mas o n√∫mero √© real
            const starsVisual = Math.min(score, 5); 
            
            for(let i=0; i<starsVisual; i++) {
                const star = document.createElement('span');
                star.innerText = '‚≠ê';
                star.className = 'text-2xl animate-bounce';
                star.style.animationDelay = `${i * 100}ms`;
                container.appendChild(star);
            }
            
            // Se tiver mais que 5, adiciona um +
            if (score > 5) {
                const plus = document.createElement('span');
                plus.innerText = '+';
                plus.className = 'text-xl font-bold text-yellow-500 ml-1';
                container.appendChild(plus);
            }
        }

        function createConfetti() {
            const colors = ['#EF476F', '#FFD166', '#06D6A0', '#118AB2'];
            for (let i = 0; i < 30; i++) {
                const conf = document.createElement('div');
                conf.classList.add('confetti');
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 4000);
            }
        }

        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'success') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start();
                osc.stop(ctx.currentTime + 0.5);
            } else {
                // Som de erro (grave e curto)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.2, ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                osc.start();
                osc.stop(ctx.currentTime + 0.3);
            }
        }

        init();

    </script>
</body>
</html>
